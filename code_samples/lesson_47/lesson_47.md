# Lesson 47
29.02.2024

Подготовка и оптимизация БД для проекта "Карточки запоминания" (Anki).

Для достижения вашей конечной цели с использованием SQLite 3, Python и модуля для чтения CSV, вы можете следовать следующему плану действий. Этот план предполагает, что у вас уже есть базовые знания о том, как работать с SQLite и Python.

1. **Подготовка данных**:
   - Убедитесь, что ваш CSV файл корректно структурирован и содержит необходимые столбцы: ID, Категории, Теги (где теги представлены в формате JSON-строки).

2. **Создание структуры базы данных**:
   - Создайте новую базу данных SQLite или используйте существующую.
   - Определите структуру таблицы для карточек (если она уже не создана).
   - Создайте таблицу для тегов, которая будет содержать уникальные идентификаторы тегов и сами теги.
   - Создайте связующую таблицу многие ко многим, чтобы связать карточки с тегами. Эта таблица должна содержать внешние ключи, указывающие на таблицу карточек и таблицу тегов.

3. **Чтение и обработка CSV файла**:
   - Используйте Python и модуль `csv` для чтения вашего CSV файла.
   - Для каждой записи извлеките ID, категории, и разберите JSON-строку тегов на отдельные теги.
   - Нобходимо сформировать сет с уникальными тегами, чтобы избежать дублирования в таблице тегов.
   - После чего можно будет начать заполнение таблиц.

На данном этапе вам необходимо написать функцию чтения данных из CSV файла и функцию для разбора JSON-строки тегов и категорий на сеты.

Функция 1. get_data_from_csv(file_path: str) -> List[Dict[str, Union[int, str]]]:
Функция 2. parse_unique_data_by_key(data: List[Dict[str, Union[int, str]]], key: str) -> Set[str]:


4. **Заполнение таблицы тегов**:
   - Для каждого уникального тега, найденного в CSV файле, проверьте, существует ли он уже в таблице тегов вашей базы данных.
   - Если тег новый, добавьте его в таблицу тегов, получив уникальный идентификатор тега.

5. **Заполнение связующей таблицы**:
   - Для каждой записи в CSV файле, используйте ID карточки и идентификаторы соответствующих тегов, чтобы заполнить связующую таблицу. Это создаст необходимые связи между карточками и их тегами.

6. **Проверка и оптимизация**:
   - После того, как все данные будут добавлены, убедитесь, что связи между таблицами корректно отражают вашу структуру данных.
   - Можете использовать индексы для оптимизации запросов, особенно если планируете часто запрашивать карточки по тегам или категориям.

7. **Работа с данными**:
   - Теперь вы можете использовать SQL запросы для извлечения карточек на основе различных критериев, таких как категории, теги или комбинации тегов.

В зависимости от ваших потребностей, этот план может быть адаптирован или расширен. Например, если вам нужно также обновлять или удалять карточки и теги, вам потребуется реализовать соответствующую логику.