# Lesson 47
29.02.2024

Подготовка и оптимизация БД для проекта "Карточки запоминания" (Anki).

Для достижения вашей конечной цели с использованием SQLite 3, Python и модуля для чтения CSV, вы можете следовать следующему плану действий. Этот план предполагает, что у вас уже есть базовые знания о том, как работать с SQLite и Python.

1. **Подготовка данных**:
   - Убедитесь, что ваш CSV файл корректно структурирован и содержит необходимые столбцы: ID, Категории, Теги (где теги представлены в формате JSON-строки).

2. **Создание структуры базы данных**:
   - Создайте новую базу данных SQLite или используйте существующую.
   - Определите структуру таблицы для карточек (если она уже не создана).
   - Создайте таблицу для тегов, которая будет содержать уникальные идентификаторы тегов и сами теги.
   - Создайте связующую таблицу многие ко многим, чтобы связать карточки с тегами. Эта таблица должна содержать внешние ключи, указывающие на таблицу карточек и таблицу тегов.

3. **Чтение и обработка CSV файла**:
   - Используйте Python и модуль `csv` для чтения вашего CSV файла.
   - Для каждой записи извлеките ID, категории, и разберите JSON-строку тегов на отдельные теги.
   - Нобходимо сформировать сет с уникальными тегами, чтобы избежать дублирования в таблице тегов.
   - После чего можно будет начать заполнение таблиц.

На данном этапе вам необходимо написать функцию чтения данных из CSV файла и функцию для разбора JSON-строки тегов и категорий на сеты.

Функция 1. get_data_from_csv(file_path: str) -> List[Dict[str, Union[int, str]]]:
Функция 2. parse_unique_data_by_key(data: List[Dict[str, Union[int, str]]], key: str) -> Set[str]:


4. **Заполнение таблицы тегов**:
   - Для каждого уникального тега, найденного в CSV файле, производим вставку в таблицу тегов. Используйте `INSERT INTO` для добавления новых тегов в таблицу.

5. **Заполнение таблицы категорий**:
   - Для каждой уникальной категории, найденной в CSV файле, производим вставку в таблицу категорий. Используйте `INSERT INTO` для добавления новых категорий в таблицу.

6. **Заполнение связующей таблицы**:
   - В нашем распоряжении есть id + категории + теги. Необходимо добавить данные в таблицу карточек и связующую таблицу.

7. **Заполнение главной таблицы**:
   - Нобходимо прочитать данные из старой БД, и добавить их в новую БД.
   - Ореинтируемся на связку ID (они есть в старой бд, а так же в CSV файле). Именно так мы свяжем старые данные с новыми.

8. **Проверка данных**:
   - Теперь вы можете использовать SQL запросы для извлечения карточек на основе различных критериев, таких как категории, теги или комбинации тегов.

В зависимости от ваших потребностей, этот план может быть адаптирован или расширен. Например, если вам нужно также обновлять или удалять карточки и теги, вам потребуется реализовать соответствующую логику.